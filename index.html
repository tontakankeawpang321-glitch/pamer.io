<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MediCheck - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Kanit -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f1f5f9;
            font-size: 16px;
            line-height: 1.6;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, select, textarea, button {
            font-size: 16px !important;
        }
        
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .modal-active {
            display: flex !important;
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .benefit-scroll::-webkit-scrollbar { width: 4px; }
        .benefit-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .benefit-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* Chat Bubbles */
        .chat-bubble-user {
            background-color: #1e293b;
            color: white;
            border-radius: 16px 16px 2px 16px;
            padding: 10px 14px;
            max-width: 85%;
            align-self: flex-end;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chat-bubble-bot {
            background-color: white;
            color: #1e293b;
            border: 1px solid #e2e8f0;
            border-radius: 16px 16px 16px 2px;
            padding: 10px 14px;
            max-width: 85%;
            align-self: flex-start;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .typing-dot {
            width: 5px; height: 5px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px; width: 24px; 
            border-radius: 50%;
            background: #1e293b;
            cursor: pointer; margin-top: -10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px;
            cursor: pointer; background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="text-slate-900 pb-32 min-h-screen relative">

    <!-- Header -->
    <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-30 shadow-md py-3 safe-area-top">
        <div class="max-w-xl mx-auto px-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="bg-blue-600 p-1.5 rounded-lg shadow-sm flex items-center justify-center">
                    <i data-lucide="activity" class="h-6 w-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white leading-none">MediCheck</h1>
                    <p class="text-xs text-slate-400 mt-0.5">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</p>
                </div>
            </div>
            <button onclick="openRightsModal()" class="flex items-center space-x-1.5 bg-blue-600 hover:bg-blue-500 text-white text-[11px] font-bold py-1.5 px-3 rounded-full shadow-lg transition-all active:scale-95 border border-blue-400/30">
                <i data-lucide="sparkles" class="w-3.5 h-3.5 animate-pulse"></i>
                <span>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏≠‡∏á (AI)</span>
            </button>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4 mt-6">
        <!-- STEP 1: INPUT FORM -->
        <div id="step-input" class="fade-in-up">
            <div class="bg-white rounded-2xl shadow-md border border-slate-200 overflow-hidden">
                <div class="bg-slate-100 px-5 py-4 border-b border-slate-200">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center">
                        <i data-lucide="clipboard-list" class="w-6 h-6 text-blue-800 mr-2"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
                    </h2>
                </div>
                
                <div class="p-5 space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-1">
                            <label class="text-sm font-bold text-slate-700 mb-2 block">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
                            <input type="number" id="age" class="w-full h-12 px-4 rounded-xl border border-slate-300 bg-white focus:border-blue-800 outline-none transition-all" placeholder="‡∏£‡∏∞‡∏ö‡∏∏">
                        </div>
                        <div class="col-span-1">
                            <label class="text-sm font-bold text-slate-700 mb-2 block">‡πÄ‡∏û‡∏®</label>
                            <select id="gender" class="w-full h-12 px-4 rounded-xl border border-slate-300 bg-white outline-none appearance-none">
                                <option value="not-specified">‡∏£‡∏∞‡∏ö‡∏∏...</option>
                                <option value="male">‡∏ä‡∏≤‡∏¢</option>
                                <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
                            </select>
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                            <label class="text-sm font-bold text-slate-700 mb-2 block">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</label>
                            <div class="relative">
                                <select id="temperature" class="w-full h-12 pl-10 pr-8 rounded-xl border border-slate-300 bg-white outline-none appearance-none">
                                    <option value="normal">‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô)</option>
                                    <option value="warm">‡∏ï‡∏±‡∏ß‡∏£‡∏∏‡∏°‡πÜ (‡∏°‡∏µ‡πÑ‡∏Ç‡πâ‡∏ï‡πà‡∏≥)</option>
                                    <option value="hot">‡∏ï‡∏±‡∏ß‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î (‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á)</option>
                                </select>
                                <i data-lucide="thermometer" class="absolute left-3 top-3.5 w-5 h-5 text-slate-400"></i>
                            </div>
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                            <label class="text-sm font-bold text-slate-700 mb-2 block">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï</label>
                            <div class="relative">
                                <select id="pressure" class="w-full h-12 pl-10 pr-8 rounded-xl border border-slate-300 bg-white outline-none appearance-none">
                                    <option value="unknown">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</option>
                                    <option value="normal">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                                    <option value="low">‡∏ï‡πà‡∏≥ (‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏î‡∏ö‡πà‡∏≠‡∏¢)</option>
                                    <option value="high">‡∏™‡∏π‡∏á (‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß)</option>
                                </select>
                                <i data-lucide="activity" class="absolute left-3 top-3.5 w-5 h-5 text-slate-400"></i>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="text-sm font-bold text-slate-700 mb-2 block">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1)</label>
                        <div class="flex flex-wrap gap-2 mb-3" id="conditions-container"></div>
                        <input type="text" id="allergies" placeholder="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏û‡πâ‡∏¢‡∏≤ / ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏£‡∏∞‡∏ö‡∏∏‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" class="w-full h-12 px-4 rounded-xl border border-slate-300 bg-white focus:border-blue-800 outline-none">
                    </div>

                    <div class="border-t border-slate-200"></div>

                    <div>
                        <label class="text-sm font-bold text-slate-700 mb-2 block">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô *</label>
                        <textarea id="symptoms" rows="3" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á, ‡πÑ‡∏≠, ‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢..." class="w-full p-4 rounded-xl border border-slate-300 bg-white focus:border-blue-800 outline-none resize-none leading-relaxed"></textarea>

                        <div class="flex flex-col gap-5 mt-5">
                            <div>
                                <label class="text-sm font-bold text-slate-700 mb-2 block">‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ô‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£</label>
                                <div class="flex rounded-xl overflow-hidden shadow-sm">
                                    <input type="number" id="duration" class="w-full h-12 px-4 border border-r-0 border-slate-300 outline-none" placeholder="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
                                    <select id="duration_unit" class="h-12 px-4 border border-l-0 border-slate-300 bg-slate-50 text-slate-700 outline-none font-medium min-w-[90px]">
                                        <option value="‡∏ß‡∏±‡∏ô">‡∏ß‡∏±‡∏ô</option>
                                        <option value="‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á">‡∏ä‡∏°.</option>
                                        <option value="‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">wk</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between items-end mb-3">
                                    <label class="text-sm font-bold text-slate-700 block">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î</label>
                                    <span id="pain-score-display" class="font-bold text-white text-base bg-blue-600 px-3 py-0.5 rounded-full shadow-sm">5 / 10</span>
                                </div>
                                <div class="h-12 flex items-center px-4 border border-slate-300 rounded-xl bg-slate-50">
                                    <input type="range" id="pain_score" min="0" max="10" step="1" value="5" class="w-full">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="analyzeSymptoms()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 flex items-center justify-center space-x-2 transition-all">
                        <span>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 2: LOADING -->
        <div id="step-loading" class="hidden h-[40vh] flex flex-col items-center justify-center text-center fade-in-up">
            <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
            <h3 class="text-lg font-bold text-slate-700">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û...</h3>
        </div>

        <!-- STEP 3: RESULT -->
        <div id="step-result" class="hidden fade-in-up pb-10">
            <div id="result-container"></div>
            <button onclick="resetForm()" class="w-full mt-6 bg-white border-2 border-slate-900 text-slate-900 font-bold py-4 rounded-xl flex items-center justify-center space-x-2 hover:bg-slate-50 transition-colors shadow-sm">
                <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</span>
            </button>
        </div>
    </main>

    <!-- RIGHTS MODAL (Gold Card Benefits - FULL LIST) -->
    <div id="rights-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm" onclick="closeRightsModal()"></div>
        <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl relative z-10 overflow-hidden flex flex-col max-h-[85vh]">
            <div class="bg-blue-600 p-6 text-white text-center flex-shrink-0 relative">
                <button onclick="closeRightsModal()" class="absolute right-4 top-4 text-white/60 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-lucide="shield-check" class="w-8 h-8"></i>
                </div>
                <h3 class="text-xl font-bold">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏≠‡∏á (‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£)</h3>
                <p class="text-blue-100 text-xs opacity-90">‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ü‡∏£‡∏µ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï AI ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2569</p>
            </div>
            <div class="bg-blue-50 px-6 py-2 border-b border-blue-100 flex justify-between items-center text-[11px] font-bold text-blue-700 uppercase tracking-wider flex-shrink-0">
                <div class="flex items-center"><i data-lucide="clock" class="w-3 h-3 mr-1"></i> <span id="last-update-text">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: 26 ‡∏°.‡∏Ñ. 69</span></div>
                <div id="ai-indicator" class="flex items-center text-green-600"><i data-lucide="check-circle" class="w-3 h-3 mr-1"></i> AI Verified</div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50 benefit-scroll" id="benefits-list"></div>
            <div class="p-5 bg-white border-t border-slate-100 flex-shrink-0">
                <button id="btn-refresh-ai" onclick="updateBenefitsWithAI()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center justify-center space-x-2">
                    <i data-lucide="refresh-cw" class="w-5 h-5" id="refresh-icon"></i>
                    <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ü‡∏£‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- CHATBOT WINDOW -->
    <div id="chatbot-window" class="fixed bottom-24 right-4 left-4 sm:left-auto sm:right-8 sm:w-[360px] h-[60vh] sm:h-[500px] bg-white rounded-3xl shadow-2xl border border-slate-200 flex flex-col hidden z-50 animate-in fade-in slide-in-from-bottom-5 duration-300 overflow-hidden">
        <div class="bg-slate-900 p-4 flex justify-between items-center text-white">
            <div class="flex items-center space-x-3">
                <div class="bg-blue-600 p-2 rounded-full"><i data-lucide="bot" class="w-5 h-5"></i></div>
                <div>
                    <h3 class="font-bold text-sm">MediBot AI</h3>
                    <p class="text-[10px] text-slate-400">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>
            </div>
            <button onclick="toggleChat()" class="p-1 hover:bg-white/10 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-slate-50 flex flex-col space-y-3 no-scrollbar scroll-smooth">
            <div class="chat-bubble-bot">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ MediBot ü§ñ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏≠‡∏á ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö</div>
        </div>
        <div class="p-4 bg-white border-t border-slate-100">
            <div class="flex space-x-2">
                <input type="text" id="chat-input" class="flex-1 bg-slate-100 rounded-2xl px-4 py-3 text-sm outline-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button onclick="sendChatMessage()" class="bg-blue-600 text-white p-3 rounded-2xl shadow-md active:scale-95"><i data-lucide="send" class="w-5 h-5"></i></button>
            </div>
        </div>
    </div>

    <!-- FLOATING CHATBOT BUTTON -->
    <button id="chatbot-floating-btn" onclick="toggleChat()" class="fixed bottom-6 right-6 bg-slate-900 hover:bg-slate-800 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center z-40 transition-transform active:scale-90 border-2 border-white/20">
        <i data-lucide="message-circle" class="w-7 h-7"></i>
    </button>

    <script>
        const allGoldCardBenefits = [
            { icon: 'ambulance', color: 'red', title: 'UCEP: ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ß‡∏¥‡∏Å‡∏§‡∏ï ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà', desc: '‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ü‡∏£‡∏µ 72 ‡∏ä‡∏°. ‡πÅ‡∏£‡∏Å‡πÉ‡∏ô ‡∏£‡∏û. ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏£‡∏±‡∏ê‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô) ‡∏´‡∏≤‡∏Å‡πÄ‡∏à‡πá‡∏ö‡∏õ‡πà‡∏ß‡∏¢‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ñ‡∏∂‡∏á‡πÅ‡∏Å‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï' },
            { icon: 'stethoscope', color: 'blue', title: '‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ü‡∏£‡∏µ', desc: '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡∏Ñ‡πà‡∏≤‡∏¢‡∏≤ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏±‡∏ç‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥' },
            { icon: 'pill', color: 'green', title: '‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô‡∏ü‡∏£‡∏µ', desc: '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° 16 ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πá‡∏ö‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ ‡∏£‡∏û.' },
            { icon: 'heart-pulse', color: 'red', title: '‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ï / ‡∏ü‡∏≠‡∏Å‡πÑ‡∏ï‡∏ü‡∏£‡∏µ', desc: '‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏ï‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡πâ‡∏≠‡∏á (‡πÅ‡∏ö‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ï‡πÄ‡∏ó‡∏µ‡∏¢‡∏°' },
            { icon: 'smile', color: 'indigo', title: '‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£‡∏ü‡∏£‡∏µ', desc: '‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô, ‡∏≠‡∏∏‡∏î‡∏ü‡∏±‡∏ô, ‡∏Ç‡∏π‡∏î‡∏´‡∏¥‡∏ô‡∏õ‡∏π‡∏ô, ‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î, ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ü‡∏•‡∏π‡∏≠‡∏≠‡πÑ‡∏£‡∏î‡πå ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ü‡∏±‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏°' },
            { icon: 'baby', color: 'pink', title: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡πá‡∏Å‡∏ü‡∏£‡∏µ', desc: '‡∏ù‡∏≤‡∏Å‡∏Ñ‡∏£‡∏£‡∏†‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û, ‡∏Ñ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏ï‡∏£‡∏ü‡∏£‡∏µ, ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô' },
            { icon: 'microscope', color: 'purple', title: '‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏ü‡∏£‡∏µ', desc: '‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏õ‡∏≤‡∏Å‡∏°‡∏î‡∏•‡∏π‡∏Å (HPV DNA), ‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÉ‡∏´‡∏ç‡πà, ‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡πÄ‡∏ï‡πâ‡∏≤‡∏ô‡∏° ‡πÅ‡∏•‡∏∞‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏õ‡∏≤‡∏Å' },
            { icon: 'video', color: 'teal', title: '‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (Telemedicine)', desc: '‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏õ‡∏Ø ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏¢‡∏≤‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ü‡∏£‡∏µ' },
            { icon: 'shield-plus', color: 'blue', title: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ', desc: '‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î ‡∏ñ‡∏∏‡∏á‡∏¢‡∏≤‡∏á‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢ ‡∏ü‡∏£‡∏µ' },
            { icon: 'user-check', color: 'slate', title: '‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏°‡∏£‡∏£‡∏ñ‡∏†‡∏≤‡∏û', desc: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏ö‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ï‡∏¥‡∏î‡πÄ‡∏ï‡∏µ‡∏¢‡∏á' }
        ];

        let formData = { 
            age: '', gender: 'not-specified', temperature: 'normal', pressure: 'unknown', 
            underlying_conditions: [], allergies: '', symptoms: '', pain_score: 5, duration: '', duration_unit: '‡∏ß‡∏±‡∏ô' 
        };

        const commonConditions = ["‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á", "‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á", "‡πÇ‡∏£‡∏Ñ‡∏´‡∏±‡∏ß‡πÉ‡∏à", "‡∏´‡∏≠‡∏ö‡∏´‡∏∑‡∏î"];

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderConditions();
            setupEventListeners();
        });

        function renderConditions() {
            const container = document.getElementById('conditions-container');
            container.innerHTML = commonConditions.map(cond => {
                const isSelected = formData.underlying_conditions.includes(cond);
                const baseClass = "text-xs py-2 px-4 rounded-xl border transition-all cursor-pointer select-none font-medium";
                const activeClass = "bg-slate-800 border-slate-800 text-white shadow-md"; 
                const inactiveClass = "bg-white border-slate-200 text-slate-600 hover:bg-slate-50";
                return `<button onclick="toggleCondition('${cond}')" class="${baseClass} ${isSelected ? activeClass : inactiveClass}">${cond}</button>`;
            }).join('');
        }

        function setupEventListeners() {
            const fields = ['age', 'gender', 'temperature', 'pressure', 'allergies', 'symptoms', 'duration', 'duration_unit', 'pain_score'];
            fields.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', (e) => {
                    formData[id] = e.target.value;
                    if (id === 'pain_score') document.getElementById('pain-score-display').textContent = `${e.target.value} / 10`;
                });
            });
        }

        function toggleCondition(cond) {
            formData.underlying_conditions = formData.underlying_conditions.includes(cond) ? formData.underlying_conditions.filter(c => c !== cond) : [...formData.underlying_conditions, cond];
            renderConditions();
        }

        async function analyzeSymptoms() {
            if (!formData.symptoms || !formData.age) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
            setStep('loading');

            const fullPrompt = `‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (Medical Triage)
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ: ‡∏≠‡∏≤‡∏¢‡∏∏ ${formData.age}, ‡πÄ‡∏û‡∏® ${formData.gender}, ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ${formData.temperature}, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ${formData.pressure}, ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß ${formData.underlying_conditions.join(',') || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}, ‡πÅ‡∏û‡πâ‡∏¢‡∏≤ ${formData.allergies || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}, ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ${formData.symptoms}, ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö ${formData.pain_score}/10, ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ô‡∏≤‡∏ô ${formData.duration} ${formData.duration_unit}. 

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô **‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
{
  "triageLevel": "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏ï‡∏¥, ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô, ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)",
  "clinicalSummary": "‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ",
  "initialTreatment": "‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£ ‡∏¢‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ",
  "doctorVisitCriteria": "‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£",
  "departmentReferral": "‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥"
}`;

            try {
                const response = await fetch("https://pamer.tontakankeawpang321.workers.dev", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: 'triage', text: fullPrompt })
                });
                const data = await response.json();
                const res = JSON.parse(data.reply.replace(/```json\n?|\n?```/g, '').trim());
                
                document.getElementById('result-container').innerHTML = `
                    <div class="bg-white rounded-2xl shadow-lg border-l-8 border-blue-600 p-6 fade-in-up">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-xl text-slate-800">${res.triageLevel}</h3>
                            <div class="text-[10px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-bold uppercase tracking-wider">AI Analysis</div>
                        </div>

                        <div class="space-y-5">
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <h4 class="font-bold text-blue-800 text-xs mb-1 uppercase flex items-center">
                                    <i data-lucide="clipboard-check" class="w-3.5 h-3.5 mr-1.5"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£
                                </h4>
                                <p class="text-sm text-slate-600 leading-relaxed">${res.clinicalSummary}</p>
                            </div>

                            <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                                <h4 class="font-bold text-green-800 text-xs mb-1 uppercase flex items-center">
                                    <i data-lucide="leaf" class="w-3.5 h-3.5 mr-1.5"></i> ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£/‡∏¢‡∏≤/‡∏≠‡∏∑‡πà‡∏ô‡πÜ)
                                </h4>
                                <p class="text-sm text-green-900 leading-relaxed">${res.initialTreatment}</p>
                            </div>

                            <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                                <h4 class="font-bold text-red-800 text-xs mb-1 uppercase flex items-center">
                                    <i data-lucide="alert-circle" class="w-3.5 h-3.5 mr-1.5"></i> ‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£
                                </h4>
                                <p class="text-sm text-red-900 leading-relaxed font-medium">${res.doctorVisitCriteria}</p>
                            </div>

                            <div class="pt-2 border-t border-slate-100 flex items-center justify-between">
                                <span class="text-[11px] text-slate-400 italic">‡πÅ‡∏ú‡∏ô‡∏Å‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${res.departmentReferral || '‡πÄ‡∏ß‡∏ä‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</span>
                                <div class="flex items-center text-[10px] text-slate-300">
                                    <i data-lucide="shield-check" class="w-3 h-3 mr-1"></i> ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                setStep('result');
                lucide.createIcons();
            } catch (e) {
                alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                setStep('input');
            }
        }

        // --- RIGHTS MODAL LOGIC ---
        function openRightsModal() {
            document.getElementById('rights-modal').classList.add('modal-active');
            renderBenefitsList();
            checkUpdateStatus();
        }

        function closeRightsModal() {
            document.getElementById('rights-modal').classList.remove('modal-active');
        }

        function renderBenefitsList() {
            const container = document.getElementById('benefits-list');
            container.innerHTML = allGoldCardBenefits.map(item => `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 flex items-start space-x-3">
                    <div class="bg-${item.color}-100 p-2 rounded-xl text-${item.color}-600 flex-shrink-0">
                        <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-800 text-sm leading-tight mb-1">${item.title}</h4>
                        <p class="text-[11px] text-slate-500 leading-relaxed">${item.desc}</p>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function checkUpdateStatus() {
            const lastDate = localStorage.getItem('last_ai_update_date');
            if (lastDate === new Date().toDateString()) {
                const btn = document.getElementById('btn-refresh-ai');
                btn.disabled = true;
                btn.className = "w-full bg-slate-100 text-slate-400 font-bold py-4 rounded-2xl flex items-center justify-center space-x-2 cursor-not-allowed";
                btn.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i> <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>`;
                document.getElementById('last-update-text').textContent = "‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ";
            }
            lucide.createIcons();
        }

        async function updateBenefitsWithAI() {
            const btn = document.getElementById('btn-refresh-ai');
            const icon = document.getElementById('refresh-icon');
            icon.classList.add('animate-spin');
            btn.disabled = true;

            await new Promise(r => setTimeout(r, 2000));
            localStorage.setItem('last_ai_update_date', new Date().toDateString());
            checkUpdateStatus();
            icon.classList.remove('animate-spin');
        }

        // --- CHATBOT LOGIC ---
        function toggleChat() {
            const win = document.getElementById('chatbot-window');
            win.classList.toggle('hidden');
            if (!win.classList.contains('hidden')) document.getElementById('chat-input').focus();
            lucide.createIcons();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            const box = document.getElementById('chat-messages');
            box.innerHTML += `<div class="chat-bubble-user">${text}</div>`;
            input.value = '';
            box.scrollTop = box.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            box.innerHTML += `<div id="${loadingId}" class="chat-bubble-bot flex space-x-1 items-center w-14 justify-center"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;
            box.scrollTop = box.scrollHeight;

            try {
                const res = await fetch("https://pamer.tontakankeawpang321.workers.dev", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: 'chat', text: text })
                });
                const data = await res.json();
                document.getElementById(loadingId).remove();
                box.innerHTML += `<div class="chat-bubble-bot">${data.reply || "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á"}</div>`;
            } catch (e) {
                document.getElementById(loadingId).remove();
                box.innerHTML += `<div class="chat-bubble-bot text-red-500">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</div>`;
            }
            box.scrollTop = box.scrollHeight;
        }

        function setStep(s) {
            ['input', 'loading', 'result'].forEach(x => document.getElementById(`step-${x}`).classList.toggle('hidden', x !== s));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetForm() {
            setStep('input');
            document.getElementById('symptoms').value = '';
        }
    </script>
</body>
</html>
